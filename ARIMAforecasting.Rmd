---
title: "ARIMA"
author: "Leobardo Enriquez"
date: '2022-05-30'
output: pdf_document
---

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo=FALSE, include=FALSE}
#Importar librerías
library(lubridate)
library(tseries)
library(lubridate)
library(tidyverse)
library(openxlsx)
library(car)
library(astsa)
library(foreign)
library(timsac)
library(vars)
library(lmtest)
library(mFilter)
library(dynlm)
library(nlme)
library(lmtest)
library(broom)
library(kableExtra)
library(knitr)
library(MASS)
library(parallel)
library(mlogit)
library(dplyr)
library(tidyr)
library(forecast)
library(fpp2)
library(stats)
library(quantmod)
```



```{r, echo=FALSE, warning=FALSE}
#Importar datos
Arimar<-read.xlsx("C:/Users/Leobardo/Downloads/Arimar.xlsx")
```

# Precios de referencia internacional del petróleo. 

En la siguiente Gráfica 1 se muestra la evolución de los precios de referencia internacional del petróleo desde enero de 2013 a marzo de 2020. Podemos observar una tendencia decreciente desde inicios del periodo hasta enero de 2016, a partir del cual se muestra una tendencia creciente hasta octubre de 2018. Esta tendencia se revierte desde finales de 2018 y persiste hasta finales del periodo analizado, a punto de alcanzar el nivel mínimo del periodo, observado en enero de 2016. 


```{r, echo=FALSE, warning=FALSE}
#Paso 1. Convertir a objeto de Serie de Tiempo en R

Arimar.ts=ts(Arimar, start=c(2013,1), frequency = 12)

plot(Arimar.ts,  main="Evolución de los precios internacionales del barril de petróleo", ylab="Precio en dólares por barril", xlab="Tiempo", col="red")



```
En la siguiente Gráfica 2, se muestra la misma serie en logaritmos, para suevizar la escala. 

```{r, echo=FALSE, warning=FALSE}
serielog=log(Arimar.ts)
plot(serielog, main="Evolución de los precios internacionales del barril de petróleo", ylab="Precio por barril en logaritmos", col="blue")



```


A continuación veremos la estacionariedad de la serie y el número de diferencias requeridas para que sea estacionaria. En este caso, la prueba al 5% de significancia estadística con las pruebas de KPSS, ADF y PP, tenemos que la estacionariedad se logra con el siguiente número de diferenciaciones:    

```{r, echo=FALSE, warning=FALSE}
#Estacionariedad: Para conocer el número de diferencias que se requieren para lograr que la serie 
#sea estacionaria

ndiffs(Arimar.ts, alpha = 0.05, test = c("kpss", "adf", "pp"), type = c("level", "trend"), max.d=2)


```

con la prueba de Dickey Fuller (DF) podemos observar que la serie no es estacionaria, ya que se tiene el siguiente p-valor mayor a 0.05, considerando un nivel de significancia estadística. 

```{r, echo=FALSE, warning=FALSE}
#Paso 2.Prueba de DickeyFuller

adf.test(Arimar.ts)

```


A continuación se grafica la serie diferenciada una vez. 


```{r, echo=FALSE, warning=FALSE}
seriedif=diff(Arimar.ts)
plot(seriedif)
```


A continuación se presenta la gráfica ACF. 


```{r, echo=FALSE, warning=FALSE}
acf(seriedif)
```

A continuación se presenta el número de diferenciaciones necesarias para que la serie diferenciada una vez sea no estacionaria. 

```{r, echo=FALSE, warning=FALSE}
ndiffs(seriedif)
```



Se presenta la prueba Dickey Fuller cpara la serie con una diferencia. El p-valor muestra que aún es no estacionaria al 5% de nivel de significancia estadística. sin embargo, parece ser no estacionaria el 10%. 

```{r, echo=FALSE, warning=FALSE}
ndiffs(seriedif)
adf.test(seriedif)
```

A continuación se presenta la gráfica de la serie con dos diferencias. 


```{r, echo=FALSE, warning=FALSE}
#Prueba de Dickey Fuller con dos diferencias
seriedif2=diff(Arimar.ts, differences =2)
plot(seriedif2)

```


A continuación se presenta la prueba de Dickey Fuller con dos diferencias.  Presenta un p-valor menor a 0.05, es decir, no se rechaza la hipótesis nula de no estacionariedad. 


```{r, echo=FALSE, warning=FALSE}
#Prueba de Dickey Fuller con dos diferencias

adf.test(seriedif2)

```

Analisis visual de las graficas.




```{r, echo=FALSE, warning=FALSE}
#Paso 4: Analisis visual de las graficas


plot(seriedif2, type="o", lty="dashed",main="Serie diferenciada (dif=2)",col="red")

```

Ahora tenemos: 


```{r, echo=FALSE, warning=FALSE}
par(mfrow=c(2,1), mar=c(4,4,4,1)+.1)
acf(seriedif2)
pacf(seriedif2)


```


Ahora tenemos: 


```{r, echo=FALSE, warning=FALSE}
par(mfrow=c(2,1), mar=c(4,4,4,1)+.1)
acf(ts(seriedif2, frequency=1))
pacf(ts(seriedif2, frequency=1))

```




Modelo ARIMA

```{r, echo=FALSE, warning=FALSE}
modelo1=arima(Arimar.ts,order=c(1,2,1))
summary(modelo1)

```

Test 

```{r, echo=FALSE, warning=FALSE}
tsdiag(modelo1)
```

Test 

```{r, echo=FALSE, warning=FALSE}
Box.test(residuals(modelo1),type="Ljung-Box")
```

A continuación se muestra la gráfica de los errores. 


```{r, echo=FALSE, warning=FALSE}
error=residuals(modelo1)
plot(error)

```



Pronóstico ARIMA para 5 periodos

```{r, echo=FALSE, warning=FALSE}
#Pronosticos Arima
pronostico=forecast::forecast(modelo1,h=5)
pronostico

```
Gráfica del pronóstico ARIMA para 5 periodos

```{r, echo=FALSE, warning=FALSE}
#Pronosticos Arima
plot(pronostico)

```




Como podemos observar, el pronóstico en general tiene  una tendencia decreciente.


